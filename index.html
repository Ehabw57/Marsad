<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="design-system.css" />
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap"
      rel="stylesheet"
    />
    <title>websocket Client</title>
  </head>
  <body
    class="cairo bg-primary text-primary flex flex-col items-center justify-center"
  >
    <header>
      <h1>نبض الفصل</h1>
      <p class="text-secondary">راقب نبض فصلك ومستوي الفهم لدي كل طالب</p>
    </header>

    <main class="flex items-center justify-center">
      <div class="chart-border flex items-center justify-center">
        <div class="chart-container flex flex-col">
          <div class="bar none flex items-center justify-center">لا توجد بيانات</div>
          <div class="bar bg-error flex items-center justify-center"></div>
          <div class="bar bg-warning flex items-center justify-center"></div>
          <div class="bar bg-success flex items-center justify-center"></div>
        </div>
      </div>
      <aside class="flex flex-col">
        <div class="info flex items-center">
          <span class="legend bg-success rounded-full"></span>
          <div>
            <h3>مستوعب بوضوح</h3>
            <p class="text-secondary">ممتاز واصل الشرح</p>
          </div>
        </div>
        <div class="info flex items-center">
          <span class="legend bg-warning rounded-full"></span>
          <div>
            <h3>احاول المتابعة</h3>
            <p class="text-secondary">قد تحتاج لتبسيط الشرح</p>
          </div>
        </div>
        <div class="info flex items-center">
          <span class="legend bg-error rounded-full"></span>
          <div>
            <h3>لا أستوعب</h3>
            <p class="text-secondary">يرجى إعادة الشرح</p>
          </div>
        </div>
        <div
          class="student-count text-secondary bg-surface flex items-center rounded-lg"
        >
          <svg
            class="fill-success"
            enable-background="new 0 0 24 24"
            height="25px"
            viewBox="0 0 24 24"
            width="25px"
          >
            <rect fill="none" height="24" width="24" />
            <g>
              <path
                d="M12,12.75c1.63,0,3.07,0.39,4.24,0.9c1.08,0.48,1.76,1.56,1.76,2.73L18,18H6l0-1.61c0-1.18,0.68-2.26,1.76-2.73 C8.93,13.14,10.37,12.75,12,12.75z M4,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C2,12.1,2.9,13,4,13z M5.13,14.1 C4.76,14.04,4.39,14,4,14c-0.99,0-1.93,0.21-2.78,0.58C0.48,14.9,0,15.62,0,16.43V18l4.5,0v-1.61C4.5,15.56,4.73,14.78,5.13,14.1z M20,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C18,12.1,18.9,13,20,13z M24,16.43c0-0.81-0.48-1.53-1.22-1.85 C21.93,14.21,20.99,14,20,14c-0.39,0-0.76,0.04-1.13,0.1c0.4,0.68,0.63,1.46,0.63,2.29V18l4.5,0V16.43z M12,6c1.66,0,3,1.34,3,3 c0,1.66-1.34,3-3,3s-3-1.34-3-3C9,7.34,10.34,6,12,6z"
              />
            </g>
          </svg>
          <span><strong>0</strong> طالب مشارك</span>
        </div>
      </aside>
    </main>

    <div class="interaction-container">
      <p class="text-secondary">تفاعل مع الدرس الان</p>
      <section class="flex justify-between">
        <div class="button-container flex flex-col items-center">
          <button
            class="interact bg-surface rounded-xl"
            onclick="socket.send('green')"
          >
            <svg
              class="fill-success"
              xmlns="http://www.w3.org/2000/svg"
              height="40px"
              viewBox="0 0 24 24"
              width="40px"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path
                d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.8 12.16 7 10.63 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"
              />
            </svg>
          </button>
          <p>مستوعب بوضوح</p>
        </div>
        <div class="button-container flex flex-col items-center">
          <button
            class="interact bg-surface rounded-xl"
            onclick="socket.send('yellow')"
          >
            <svg
              class="fill-warning"
              height="40px"
              viewBox="0 0 24 24"
              width="40px"
            >
              <path d="M0 0h24v24H0V0z" fill="none" />
              <path
                d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"
              />
            </svg>
          </button>
          <p>احاول المتابعة</p>
        </div>
        <div class="button-container flex flex-col items-center">
          <button
            class="interact bg-surface rounded-xl"
            onclick="socket.send('red')"
          >
            <svg
              class="fill-error"
              enable-background="new 0 0 20 20"
              height="40px"
              viewBox="0 0 20 20"
              width="40px"
            >
              <rect fill="none" height="20" width="20" />
              <path
                d="M15.5,6.5c-0.17,0-0.34,0.02-0.5,0.06V3.5c0-1.1-0.9-2-2-2c-0.19,0-0.37,0.03-0.55,0.08C12.26,0.67,11.46,0,10.5,0 C9.62,0,8.88,0.56,8.61,1.34C8.42,1.28,8.21,1.25,8,1.25c-1.1,0-2,0.9-2,2v0.81C5.84,4.02,5.67,4,5.5,4c-1.1,0-2,0.9-2,2v7 c0,3.87,3.13,7,7,7s7-3.13,7-7V8.5C17.5,7.4,16.6,6.5,15.5,6.5z M16,13c0,3.04-2.46,5.5-5.5,5.5S5,16.04,5,13V6 c0-0.28,0.22-0.5,0.5-0.5S6,5.72,6,6v4h1.5V3.25c0-0.28,0.22-0.5,0.5-0.5s0.5,0.22,0.5,0.5V9H10V2c0-0.28,0.22-0.5,0.5-0.5 S11,1.72,11,2v7h1.5V3.5C12.5,3.22,12.72,3,13,3s0.5,0.22,0.5,0.5l0,7.79C12.03,11.88,11,13.32,11,15h1.5c0-1.38,1.12-2.5,2.5-2.5 v-4C15,8.22,15.22,8,15.5,8S16,8.22,16,8.5V13z"
              />
            </svg>
          </button>
          <p>لا أستوعب</p>
        </div>
      </section>
    </div>
  </body>
  <!-- <script src="test.js"> </script> -->
  <script>
    const socket = new WebSocket("wss://snuffly-wendie-seasonally.ngrok-free.dev");
    socket.onopen = () => {
      console.log("WebSocket connection established");
    };

    socket.onerror = (error) => {
      console.error("WebSocket error:", error);
    };

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const greenPresent = (data.green / data.count) * 100;
      const yellowPresent = (data.yellow / data.count) * 100;
      const redPresent = (data.red / data.count) * 100;
      const bars = document.querySelectorAll(".bar");
      bars.forEach((bar) => {
        bar.style.height = "0";
        bar.textContent = "";
      });
      if (!greenPresent && !yellowPresent && !redPresent) {
        bars[0].style.height = `100%`;
        bars[0].textContent = `لاتوجد بيانات`;
        return;
      }
      if (greenPresent) {
        bars[3].style.height = `${greenPresent}%`;
        bars[3].textContent = `${Math.floor(greenPresent)}%`;
      }
      if (yellowPresent) {
        bars[2].style.height = `${yellowPresent}%`;
        bars[2].textContent = `${Math.floor(yellowPresent)}%`;
      }
      if (redPresent) {
        bars[1].style.height = `${redPresent}%`;
        bars[1].textContent = `${Math.floor(redPresent)}%`;
      }

      const studentCount = document.querySelector(".student-count strong");
      studentCount.textContent = data.count;
    };
  </script>
</html>
